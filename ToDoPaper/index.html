<!doctype html>

<html lang="en">

<head>
  <meta charset="utf-8">

  <title>My homework</title>
  <meta name="description" content="Second homework">
  <meta name="author" content="Sergey Khristenko">
</head>

<body>
  <div id="todo-items" style="width: 500px; margin:auto">
    <H3 style="text-align: center">TODOS
      <span id="totalTodos"></span>
    </H3>
    <div style="text-align: center">
      <input type="radio" name="viewTodoList" onclick="viewTodoList('all')" id="all" value="all" checked>
      <label for="all">All todos</label>
      <input type="radio" name="viewTodoList" onclick="viewTodoList('completed')" id="completed" value="completed">
      <label for="completed">Completed todos</label>
      <input type="radio" name="viewTodoList" onclick="viewTodoList('not_completed')" id="not_completed" value="not_completed">
      <label for="not_completed">Not completed todos</label>
    </div>
    <div style="padding: 30px; text-align: center">
      <input type="text" id="newTodoText" style="width: 75%; float: left">
      <button id="addTodo" style="width: 20%; float: left">Add</button>
    </div>

    <ul></ul>
  </div>
</body>

<script src="jquery-3.3.1.min.js"></script>
<script src="functions.js"></script>
<script src="dom.js"></script>
<script src="script.js"></script>

<script>
  window.onload = function () {
    initView();
    showTotalTodoCount();
  }
</script>

<script>
  document.getElementById('addTodo').addEventListener('click', submitTodo);
  document.getElementById('newTodoText').addEventListener('keyup', submitTodo);

  function submitTodo(event) {
    if (event.code === 'Enter' || event.type === 'click') {
      const input = document.getElementById('newTodoText');
      const newId = Math.max(...todoItems.map(item => item.id)) + 1;

      addTodoItem({ text: input.value, completed: false, id: newId });
      input.value = '';
    }
  }

  document.getElementById('todo-items').addEventListener('click', function (event) {
    if (event.target.name === 'completedTodo') {

      const id = (event.target.parentElement.id).replace(/\D/g, '');
      completeTodoItem(Number(id));
      event.target.checked = true;

      setTimeout(() => event.preventDefault(), 0);
    }
  });

  document.getElementById('todo-items').addEventListener('click', function (event) {
    if (event.target.name === 'deleteBtn') {
      const id = (event.target.parentElement.id).replace(/\D/g, '');
      deleteTodoItem(Number(id));
    }
  });

  document.getElementById('todo-items').addEventListener('click', function (event) {
    if (event.target.name === 'editBtn') {
      const prevValue = event.target.parentElement.querySelector('span');
      const el = event.target.parentElement.querySelector('input[name="editTodo"]');
      el.setAttribute('style', 'display: inline-block; width: 296px');
      el.value = prevValue.textContent;
      prevValue.setAttribute('style', 'display:none');
      el.focus();

      el.addEventListener('focusout', editTodo);
      el.addEventListener('keyup', editTodo);

      function editTodo(event) {
        if (event.code === 'Enter' || event.type === 'focusout') {
          const id = Number((event.target.parentElement.id).replace(/\D/g, ''));
          editTodoItem(id, event.target.value);
          el.setAttribute('style', 'display: none');
          prevValue.setAttribute('style', 'display: inline-block; width: 300px;');

          el.removeEventListener('focusout', editTodo);
          el.removeEventListener('keyup', editTodo);
        }
      }

    }
  });
</script>

</html>